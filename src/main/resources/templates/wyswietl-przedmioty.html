<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wywietl Przedmioty</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container">
<h1>Przedmioty</h1>
    <a href="/books" class="btn btn-secondary">Wyszukaj ksi偶ki</a>
    <a href="/books/new" class="btn btn-secondary">Dodaj ksi偶ki</a>
    <a href="/wyswietl-przedmioty" class="btn btn-secondary">Przedmioty</a>
    <a href="/dodaj-przedmiot" class="btn btn-secondary">Dodaj przedmioty</a>

    <div class="alert alert-info mt-3">
        <h5> Jak to dziaa</h5>
        <p>
            Ta strona wywietla list wszystkich aktualnie dostpnych przedmiot贸w.
            Po zaadowaniu, wysyane jest 偶danie <code>GET</code> na adres <code>/wyswietl-przedmioty</code>, kt贸re jest obsugiwane przez metod <code>pokazListePrzedmiotow()</code> w kontrolerze <code>PrzedmiotController</code>.
            Kontroler pobiera z bazy danych MongoDB list wszystkich dokument贸w z kolekcji "przedmioty" za pomoc metody <code>findAll()</code> udostpnianej przez <code>PrzedmiotRepository</code>.
            Dane te s nastpnie przekazywane do tego szablonu HTML (<code>wyswietl_przedmioty.hhtml</code>) za pomoc Thymeleaf, kt贸ry dynamicznie generuje tabel HTML. Ka偶dy wiersz tabeli reprezentuje jeden przedmiot, wywietlajc jego ID, nazw oraz list jego cech (klucz i warto).
        </p>
        <p>
            Na g贸rze strony znajduj si formularze umo偶liwiajce wyszukiwanie przedmiot贸w:
        <ul>
            <li>
                <strong>Wyszukaj przedmioty po cesze:</strong> Ten formularz wysya 偶danie <code>GET</code> na adres <code>/wyszukaj-po-cesze</code> z podan nazw cechy. Kontroler u偶ywa <code>PrzedmiotRepository.znajdzPrzedmiotyPoCechie()</code> do pobrania przedmiot贸w posiadajcych t cech.
            </li>
            <li>
                <strong>Wyszukaj przedmioty po cesze i wartoci:</strong> Ten formularz wysya 偶danie <code>GET</code> na adres <code>/wyszukaj-po-cesze-wartosc</code> z podan nazw cechy i jej wartoci. Kontroler u偶ywa <code>PrzedmiotRepository.znajdzPrzedmiotyPoCechieWartosc()</code> do pobrania przedmiot贸w, kt贸re maj t cech o okrelonej wartoci.
            </li>
        </ul>
        Wyniki wyszukiwania s wywietlane w tej samej tabeli przedmiot贸w.
        </p>
        <p>
            Na dole strony znajduje si przycisk "Dodaj Nowy Przedmiot", kt贸ry przekierowuje do formularza dodawania nowych przedmiot贸w (<code>/dodaj-przedmiot</code>).
        </p>
    </div>

        <h2 class="mt-3">Wyszukaj przedmioty</h2>
        <form th:action="@{/wyszukaj}" method="get" class="row g-3 align-items-center">
            <div class="col-auto">
                <label for="nazwaCechyWartosc" class="form-label">Nazwa cechy:</label>
            </div>
            <div class="col-auto">
                <input type="text" class="form-control" id="nazwaCechyWartosc" name="nazwaCechy" required>
            </div>
            <div class="col-auto">
                <label for="wartoscCechy" class="form-label">Warto cechy:</label>
            </div>
            <div class="col-auto">
                <input type="text" class="form-control" id="wartoscCechy" name="wartoscCechy">
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-success">Wyszukaj</button>
            </div>
        </form>
    </div>

    <h2 th:if="${wyszukiwanieInfo}" th:text="${wyszukiwanieInfo}"></h2>

    <table class="table table-bordered">
        <thead><tr><th>ID</th><th>Nazwa</th><th>Cechy</th><th>Akcje</th></tr></thead>
        <tbody>
        <tr th:each="przedmiot : ${przedmioty}">
            <td th:text="${przedmiot.id}"></td>
            <td th:text="${przedmiot.nazwa}"></td>
            <td>
                <ul class="list-unstyled" th:if="${not #maps.isEmpty(przedmiot.cechy)}">
                    <li th:each="cecha : ${przedmiot.cechy}" th:text="${cecha.key + ': ' + cecha.value}"></li>
                </ul>
                <p th:if="${#maps.isEmpty(przedmiot.cechy)}">Brak cech.</p>
            </td>
            <td>
                <form th:action="@{'/przedmioty/delete/' + ${przedmiot.id}}" method="post">
                    <button type="submit" class="btn btn-danger btn-sm">Usu</button>
                </form>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(przedmioty)}">
            <td colspan="3">Brak dostpnych przedmiot贸w.</td>
        </tr>
        </tbody>
    </table>
    <p><a href="/dodaj-przedmiot" class="btn btn-primary">Dodaj Nowy Przedmiot</a></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>